# STM32主从双机SPI通信测试（代码在SPI_DEMO,点下star可以收藏起来不会丢）

#### **实现功能：主从设备可以互相接收到对方的数据**

**stm32f103c8t6主< —————>stm32f103c8t6从**

**接线：**

                                                     主（SPI1）                                          从（SPI1）

                                                MOSI（PA7）           <——>               MOSI（PA7）

                                             MISO（PA6）           <——>               MISO（PA6）

                                                SPI_CLK(PA5)            <——>               SPI_CLK(PA5)

                                                SPI_NSS(PA8)            <——>               SPI_NSS(PA4)  

连线是一一对应的，不能将MOSI接上MISO，且两个设备的配置参数速率、相位、极性、CRC和传输方向及位数要相同，**一定要共地**。
**测试效果**：
![f974679fd95c14e502c061078e55298](https://github.com/imagine90/STM32_DEMO/blob/2bb9ba5832fb334d2a6b9125431e949d67ca1f6f/f974679fd95c14e502c061078e55298.png)


COM8是主设备接收到从设备的数据  COM4是从设备接收到主设备的数据

很明显的问题，主设备没能成功获取到从设备的数据，从设备接收到主设备的数据。

### **问题分析：**

1、问题出现在主设备：主设备没接收或者没响应。

2、问题出现在从设备：从设备并没发送数据。

3、以上两个问题同时出现。

### **排插问题**：

1、首先，我将主设备的MOSI连上自身主设备的MISO，测试结果，主设备是可以接收数据。排除了第一种可能。

2、在主从设备进行通信时，利用逻辑分析仪来检测MISO引脚，**没能检测到任何波形变化**。问题很可能就是从设备。

于是，我将从设备换成了STM32F429,主设备还是STM32F103C8,程序也一样。

**stm32f103c8t6主< —————>stm32f429IG从**

**接线：**

                                                     主（SPI1）                                          从（SPI2）

                                               MOSI（PA7）           <——>               MOSI（PB12）

                                             MISO（PA6）           <——>               MISO（PB13）

                                               SPI_CLK(PA5)            <——>               SPI_CLK(PB14)

                                               SPI_NSS(PA8)            <——>               SPI_NSS(PB15)  
